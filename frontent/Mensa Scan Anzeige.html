<!DOCTYPE html>
<html lang="de">
<head>

    <link rel="stylesheet" href="style.css">
     <meta charset="UTF-8">
  <title>Mensamenü</title>

</head>

<script>
    document.addEventListener("click",()=>{document.getElementById("userID").focus();})
    const url = "http://kantinekasse"
    //wasauchimmer
</script>

<body>
    <h1>Mensa Menü</h1>
    <form id="form">
        <!-- Text Input -->
        <label for="userID">ID-Nummer:</label>
        <input type="text" id="userID" name="userID" required autofocus>
        <br><br><br>

        <!-- ordered_item Checkbox -->
      

      <div class="spalten">

        <label for="ordered_item" >3,00€</label>
        <input type="radio" id="ordered_item1" name="ordered_item" value="3.00">
        <br><br>

        <label for="ordered_item">3,50€</label>
        <input type="radio" id="ordered_item2" name="ordered_item" value="3.50">
        <br><br>

        <label for="ordered_item">4,50€</label>
        <input type="radio" id="ordered_item3" name="ordered_item" value="4.50">
        <br><br>

        <label for="ordered_item">6,00€</label>
        <input type="radio" id="ordered_item4" name="ordered_item" value="6.00">
        <br><br>

        <label for="ordered_item">6,50€</label>
        <input type="radio" id="ordered_item5" name="ordered_item" value="6.50">
     
     </div>


     <div>   

        <label for="ordered_item">6,90€</label>
        <input type="radio" id="ordered_item6" name="ordered_item" value="6.90" >
        <br><br>
            
        <label for="ordered_item">7,00€</label>
        <input type="radio" id="ordered_item7" name="ordered_item" value="7.00" >
        <br><br>
        
        <label for="ordered_item">7,50€</label>
        <input type="radio" id="ordered_item8" name="ordered_item" value="7.50">
        <br><br>
              
        <label for="ordered_item">7,90€</label>
        <input type="radio" id="ordered_item9" name="ordered_item" value="7.90" >
        <br><br>

        <label for="ordered_item">8,50€</label>
        <input type="radio" id="ordered_item10" name="ordered_item" value="8.50">

     </div> 

        <br><br><br>

        <label for="tax">Hier essen (7% Steuer)</label>

        <input type="radio" name="tax" value="7" checked style="margin-right: 25px;">
       
        <label for="tax">Mitnehmen (19% Steuer)</label>
        <input type="radio" name="tax" value="19">
        
        <br><br><br><br>

        <!-- Submit Button -->
        <button type='submit' class="button">Bestätigen</button>
    </form>


<script>
    document.getElementById("form").addEventListener("submit", (event) => {
        const userID = document.getElementById("userID").value.trim();
        event.preventDefault()
    
        var formadata = new FormData(event.target)
        if(!formadata.get("userID")){
            alert("keine ID-Nummer")
            return
        }else if(!formadata.get("ordered_item")){
            alert("kein Menü")
            return
        }else if(!formadata.get("tax")){
            alert("keine Steuer")
            return
        }

        fetch(url+/orders/, { method: "POST", body: new FormData(document.forms[0]) })
          .then(
            response => {
              console.log(response.status);
                    response.text().then(
                        text => {
                            response_obj = JSON.parse(text)
                            if(response.status == 400 ){
                                if (Object.hasOwn(response_obj,"userID") && Object.hasOwn(response_obj,"order") ){
                                    const confirmOverwrite = confirm("Der Benutzer hat heute schon bestellt: " +response_obj["order"]["ordered_item"]+"€ + " +response_obj["order"]["tax"]+"% Steuer. Soll die Bestellung mit den neuen Daten korrigiert werden?"  );
                                    if (confirmOverwrite) {
                                    // let restext = '{"userID":["The user already ordered today. "], "order": 12}'
                                        console.log(text)       
                                        console.log(response_obj["userID"][0])
                                        fetch(url+JSON.parse(text)["order"]["url"], { method: "PUT", body: new FormData(document.forms[0]) }).then(
                                            response => {
                                                if(response.status == 200 ){
                                                    alert("Erfolgreich")
                                                } else {
                                                    response.text().then(errortext => {
                                                        alert( errortext )
                                                    })
                                                }
                                            })
                                } else {
                                    console.log(response_obj)
                                    const confirmOverwrite = alert(text);
                                }
                           } 
                        // alert(text)
                        } // Handle here
                    });                    
            } // .json(), .blob(), etc.
          )
    });
</script>

</body>
</html>